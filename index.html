<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-transform, no-siteapp">
    <meta name="referrer" content="never">
    <meta name="renderer" content="webkit">
    <!-- 核心：移动端viewport适配，禁止缩放 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>随机视频_双端适配版</title>
    <link rel="stylesheet" href="./assets/style.css">
    <style>
        /* 全局样式重置：消除默认边距，统一盒模型 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: #1a1a1a; /* 深色背景提升视频对比度 */
            min-height: 100vh; /* 让body占满屏幕高度，方便居中 */
            padding: 15px;
        }

        /* 核心：视频容器 - 实现垂直+水平双居中 */
        .video-container {
            display: flex;
            flex-direction: column;
            align-items: center; /* 水平居中 */
            justify-content: center; /* 垂直居中 */
            min-height: calc(100vh - 120px); /* 预留控件区域高度 */
            margin-bottom: 25px;
        }

        /* 视频样式：响应式缩放，不超出屏幕 */
        #player {
            width: 100%;
            max-width: 1200px; /* 电脑端最大宽度，避免过宽 */
            max-height: 80vh; /* 电脑端最大高度，避免过窄 */
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5); /* 阴影增强层次感 */
            object-fit: contain; /* 保证视频比例不拉伸 */
        }

        /* 加载提示：与视频同宽居中 */
        .loading {
            color: #fff;
            font-size: 18px;
            margin-bottom: 15px;
            text-align: center;
            width: 100%;
            max-width: 1200px;
        }

        /* 控件容器：基础样式 */
        .control-buttons {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-wrap: wrap; /* 允许换行，适配手机 */
            gap: 12px;
            align-items: center;
        }

        /* 按钮基础样式 */
        .control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            background: #2563eb;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
            flex: 1; /* 让按钮自适应宽度 */
            min-width: 120px; /* 手机端按钮不致过窄 */
        }
        .control-btn:hover {
            background: #1d4ed8;
        }

        /* 收藏链接样式 */
        .favorite-link {
            color: #93c5fd;
            text-decoration: none;
            font-size: 16px;
            flex: 1;
            min-width: 120px;
            text-align: center;
            padding: 12px 0;
        }
        .favorite-link:hover {
            color: #bfdbfe;
            text-decoration: underline;
        }

        /* 状态提示：靠右显示 */
        .play-status {
            color: #d1d5db;
            font-size: 14px;
            margin-left: auto;
            padding: 0 12px;
        }

        /* 媒体查询：手机端（768px以下）专项优化 */
        @media (max-width: 768px) {
            .video-container {
                min-height: calc(100vh - 200px); /* 预留更多控件高度 */
            }

            .control-buttons {
                flex-direction: column; /* 控件垂直排列，避免拥挤 */
                gap: 10px;
            }

            .control-btn, .favorite-link {
                width: 100%; /* 按钮占满屏幕宽度，方便触控 */
                min-width: auto;
                padding: 15px 0; /* 增大点击区域 */
                font-size: 18px; /* 字体放大，便于查看 */
            }

            .play-status {
                margin-left: 0;
                margin-top: 10px;
                font-size: 16px;
            }

            .loading {
                font-size: 20px; /* 加载提示放大 */
            }
        }
    </style>
</head>
<body>
    <!-- 视频容器：核心居中容器 -->
    <div class="video-container">
        <div class="loading" id="loadingTip" style="display: none;">视频加载中，请稍候...</div>
        <video 
            id="player" 
            src="video.php" 
            controls 
            webkit-playsinline 
            playsinline
            preload="metadata"
        ></video>
    </div>

    <!-- 控件区域：双端自适应布局 -->
    <div class="control-buttons">
        <button class="control-btn" id="switch">连续播放: 开</button>
        <button class="control-btn" id="next">播放下一个</button>
        <a href="/" class="favorite-link">我的收藏夹</a>
        <span class="play-status" id="playStatus">就绪</span>
    </div>

    <script>
    (function (window, document) {
        // 防嵌套：确保页面独立运行
        if (top !== self) {
            window.top.location.replace(self.location.href);
        }

        // 工具函数
        const getEl = (id) => document.getElementById(id);
        const bindEvt = (el, evt, fn) => el.addEventListener(evt, fn);

        // 状态管理
        let isAutoPlay = true;
        const player = getEl('player');
        const loadingTip = getEl('loadingTip');
        const playStatus = getEl('playStatus');
        const switchBtn = getEl('switch');

        // 核心：加载随机视频（带状态反馈）
        const loadRandomVideo = () => {
            loadingTip.style.display = 'block';
            player.style.display = 'none';
            playStatus.textContent = '加载中...';

            // 防缓存随机视频源
            player.src = `http://v.nrzj.vip/video.php?_t=${Math.random()}`;

            // 加载成功回调
            player.onloadedmetadata = () => {
                loadingTip.style.display = 'none';
                player.style.display = 'block';
                playStatus.textContent = '播放中';
                player.play().catch(err => {
                    // 处理自动播放被浏览器拦截的情况（手机端常见）
                    playStatus.textContent = '请点击播放';
                });
            };

            // 加载失败回调
            player.onerror = () => {
                playStatus.textContent = '加载失败，重试中...';
                setTimeout(loadRandomVideo, 1500); // 延迟重试，减少无效请求
            };
        };

        // 事件绑定：双端适配交互
        bindEvt(getEl('next'), 'click', loadRandomVideo);

        // 连续播放切换
        bindEvt(switchBtn, 'click', () => {
            isAutoPlay = !isAutoPlay;
            switchBtn.textContent = `连续播放: ${isAutoPlay ? '开' : '关'}`;
            playStatus.textContent = isAutoPlay ? '已开启连续播放' : '已关闭连续播放';
        });

        // 视频播放结束
        bindEvt(player, 'ended', () => {
            playStatus.textContent = '播放结束';
            if (isAutoPlay) setTimeout(loadRandomVideo, 800);
        });

        // 播放/暂停状态反馈
        bindEvt(player, 'play', () => playStatus.textContent = '播放中');
        bindEvt(player, 'pause', () => playStatus.textContent = '已暂停');

        // 初始化：检测是否有视频源，无则加载
        if (!player.src) loadRandomVideo();
    })(window, document);
    </script>

    <!-- 百度统计脚本 -->
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?a8569fd6981018f096d774868306a054";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
</body>
</html>
